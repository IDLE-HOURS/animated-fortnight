{"version":3,"file":"picostate.es.js","sources":["../index.ts"],"sourcesContent":["type HydrateFunction<S> = (s: S) => Partial<S>;\ntype Hydrate<S> = Partial<S> | HydrateFunction<S>;\ntype ListenerFunction<S> = (s: S) => any;\n\nexport default function createStore<State>(initialState: Partial<State>) {\n  let state = Object.assign({}, initialState);\n  let lastFiredState = Object.assign({}, initialState);\n  let listeners = {};\n\n  return {\n    get state(): Partial<State> {\n      return { ...state };\n    },\n    hydrate(fn?: Hydrate<State>): () => void {\n      state = fn\n        ? Object.assign(\n            this.state,\n            typeof fn === \"function\" ? fn(this.state) : fn\n          )\n        : initialState;\n\n      return () => {\n        const changed = Object.keys(state).reduce((keys, key) => {\n          if (state[key] !== lastFiredState[key]) return keys.concat(key);\n          return keys;\n        }, []);\n\n        lastFiredState = state;\n\n        if (!changed.length) return;\n\n        const fired = [];\n\n        for (const key of changed.concat(\"*\")) {\n          for (const fn of listeners[key] || []) {\n            if (fired.indexOf(fn) > -1) continue;\n            fn({ ...state });\n            fired.push(fn);\n          }\n        }\n      };\n    },\n    listen(\n      evs: string | string[] | ListenerFunction<State>,\n      fn?: ListenerFunction<State>\n    ): () => void {\n      if (!fn && typeof evs === \"function\") {\n        fn = evs;\n        evs = \"*\";\n      }\n\n      const keys = [].concat(evs);\n\n      for (const key of keys) {\n        listeners[key] = (listeners[key] || []).concat(fn);\n      }\n\n      return () => {\n        for (const key of keys) {\n          listeners[key].splice(listeners[key].indexOf(fn), 1);\n        }\n      };\n    }\n  };\n}\n"],"names":["initialState","state","Object","assign","lastFiredState","listeners","hydrate","fn","this","changed","keys","reduce","key","concat","length","fired","const","indexOf","push","listen","evs","splice"],"mappings":"wBAI2CA,OACrCC,EAAQC,OAAOC,OAAO,GAAIH,GAC1BI,EAAiBF,OAAOC,OAAO,GAAIH,GACnCK,EAAY,SAET,oBAEIH,iBAAKD,IAEdK,iBAAQC,UACNN,EAAQM,EACJL,OAAOC,OACLK,KAAKP,MACS,mBAAPM,EAAoBA,EAAGC,KAAKP,OAASM,GAE9CP,iBAGIS,EAAUP,OAAOQ,KAAKT,GAAOU,gBAAQD,EAAME,UAC3CX,EAAMW,KAASR,EAAeQ,GAAaF,EAAKG,OAAOD,GACpDF,GACN,OAEHN,EAAiBH,EAEZQ,EAAQK,eAEPC,EAAQ,SAEIN,EAAQI,OAAO,yBAA5BG,UACcX,SAAkB,mBAAI,CAAlCW,IAAMT,OACLQ,EAAME,QAAQV,IAAO,IACzBA,EAAGL,iBAAKD,IACRc,EAAMG,KAAKX,OAKnBY,gBACEC,EACAb,GAEKA,GAAqB,mBAARa,IAChBb,EAAKa,EACLA,EAAM,aAGFV,EAAO,GAAGG,OAAOO,SAELV,kBAAM,CAAnBM,IAAMJ,OACTP,EAAUO,IAAQP,EAAUO,IAAQ,IAAIC,OAAON,yBAI1C,UAAaG,kBAAM,CAAnBM,IAAMJ,OACTP,EAAUO,GAAKS,OAAOhB,EAAUO,GAAKK,QAAQV,GAAK"}